# linux-punto-switcher
punto-switcher for linux in one .c file

реализованные функции в `keydeamon.c`:
- исправление раскладки последнего слова по нажатию `Pause` (эта фича не требует наличия графического интерфейса. Почти полная аналогия [easy-switcher](https://github.com/freemind001/easy-switcher))
- изменение раскладки выделенного текста по `Alt+Pause`
- изменение регистра выделенного текста по `Shift+Pause`  
и еще дополнительная программка `keyview.c` - просто посмотреть как нажимаются клавиши клавиатуры, а также их key-коды

### как оно работает:  
- неотступно следит за нажатием и отпусканием всех клавиш клавиатуры
- при нажатии `Pause` 
	- несколько раз нажимает `backspace`, 
	- потом `CapsLock`, 
	- потом нажимает те же клавиши, которыми было набрано это слово.
- при нажатии `Alt+Pause` или `Shift+Pause` 
	- ждёт когда `Alt` и `Shift` будут отпущены
	- запоминает старое содержимое буфера обмена
	- нажимает `Ctrl+X`, ждёт 0.3 сек
	- считывает новое содержимое буфера обмена, конвертирует его
	- устанавливает новое содержимое буфера обмена
	- нажимает `Ctrl+V`
	- восстанавливает исходное содержимое буфера обмена
	- нажимает `CapsLock`  
можно настроить способ изменения раскладки клавиатуры в функции `void change_layout()` в `keydeamon.c`

### как собрать и установить
зависимость: `sudo apt install libdbus-1-dev`
```bash
make
sudo make install
make user-setup # без sudo
```
запуск без установки:
```bash
sudo chown root linux-punto-switcher
sudo chmod u+s linux-punto-switcher
./linux-punto-switcher
```
удаление:
```bash
sudo make uninstall-system
make uninstall-user # без sudo
```
### системные компоненты:
- для отслеживания клавиатуры используется `linux/input` - требует root-прав
- для эмуляции нажатий на клавиатуру используется `linux/uinput`  - требует root-прав
- для работы с буфером обмена используется `dbus` (который сейчас настроен на работу с KDE) - требует работу от имени пользователя
### todo
- автоопределение клавиатуры
- настройка способа переключения раскладки
- автоопределение рабочего стола
- deb-пакет