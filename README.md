# linux-punto-switcher
punto-switcher for linux

реализованные функции:
- исправление раскладки последнего слова по нажатию `Pause` (эта фича не требует наличия графического интерфейса. Почти полная аналогия [easy-switcher](https://github.com/freemind001/easy-switcher))
- изменение раскладки выделенного текста по `Alt+Pause`
- изменение регистра выделенного текста по `Shift+Pause`
### как оно работает:  
- неотступно следит за нажатием и отпусканием всех клавиш клавиатуры
- при нажатии `Pause` 
	- несколько раз нажимает `backspace`, 
	- потом `CapsLock`, 
	- потом нажимает те же клавиши, которыми было набрано это слово.
- при нажатии `Alt+Pause` или `Shift+Pause` 
	- ждёт когда `Alt` и `Shift` будут отпущены
	- запоминает старое содержимое буфера обмена
	- нажимает `Ctrl+X`, ждёт 0.3 сек или пока содержимое буфера обмена не поменяется
	- считывает новое содержимое буфера обмена, конвертирует его
	- устанавливает новое содержимое буфера обмена
	- нажимает `Ctrl+V`
	- восстанавливает исходное содержимое буфера обмена
	- нажимает `CapsLock`

можно настроить способ изменения раскладки клавиатуры в функции `void change_layout()` в `keydeamon.c`
### как собрать и установить
зависимость: `sudo apt install libdbus-1-dev`
```bash
make
sudo make install
make user-setup # без sudo
```
запуск без установки:
```bash
sudo chown root linux-punto-switcher
sudo chmod u+s linux-punto-switcher
./linux-punto-switcher
```
удаление:
```bash
make uninstall-user # без sudo
sudo make uninstall-system
```
### системные компоненты:
- для отслеживания клавиатуры используется `linux/input` - требует root-прав
- для эмуляции нажатий на клавиатуру используется `linux/uinput`  - требует root-прав
- для работы с буфером обмена используется `dbus` (который сейчас настроен на работу с KDE) - требует работу от имени пользователя
# todo
- сделать автоподключение устройств
- сделать реакцию на нажатия мышки (сброс буфера)
- сделать буфер обмена для всех wayland
- сделать буфер обмена для всех X11
- deb-пакет
- сделать настройки в json или yaml файле
- сделать задержку после смены раскладки (для Gnome)
- из программки keyview сделать создавалку файла настроек
- потестировать автоопределение клавиатуры на устройствах без физической клавиатуры (tablet pc)
# done
- ~~автоопределение клавиатуры~~ 25-07-24
