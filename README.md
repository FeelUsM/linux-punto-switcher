# linux-punto-switcher
punto-switcher for linux in one .c file

—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `keydeamon.c`:
- –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–æ–≤–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é `Pause` (—ç—Ç–∞ —Ñ–∏—á–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü–æ—á—Ç–∏ –ø–æ–ª–Ω–∞—è –∞–Ω–∞–ª–æ–≥–∏—è [easy-switcher](https://github.com/freemind001/easy-switcher))
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ `Alt+Pause`
- –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ `Shift+Pause`

–∏ –µ—â–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∫–∞ `keyview.c` - –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –Ω–∞–∂–∏–º–∞—é—Ç—Å—è –∫–ª–∞–≤–∏—à–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, –∞ —Ç–∞–∫–∂–µ –∏—Ö key-–∫–æ–¥—ã

### –∫–∞–∫ –æ–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:  
- –Ω–µ–æ—Ç—Å—Ç—É–ø–Ω–æ —Å–ª–µ–¥–∏—Ç –∑–∞ –Ω–∞–∂–∞—Ç–∏–µ–º –∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∫–ª–∞–≤–∏—à –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ `Pause` 
	- –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∞–∂–∏–º–∞–µ—Ç `backspace`, 
	- –ø–æ—Ç–æ–º `CapsLock`, 
	- –ø–æ—Ç–æ–º –Ω–∞–∂–∏–º–∞–µ—Ç —Ç–µ –∂–µ –∫–ª–∞–≤–∏—à–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –±—ã–ª–æ –Ω–∞–±—Ä–∞–Ω–æ —ç—Ç–æ —Å–ª–æ–≤–æ.
- –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ `Alt+Pause` –∏–ª–∏ `Shift+Pause` 
	- –∂–¥—ë—Ç –∫–æ–≥–¥–∞ `Alt` –∏ `Shift` –±—É–¥—É—Ç –æ—Ç–ø—É—â–µ–Ω—ã
	- –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
	- –Ω–∞–∂–∏–º–∞–µ—Ç `Ctrl+X`, –∂–¥—ë—Ç 0.3 —Å–µ–∫
	- —Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –µ–≥–æ
	- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
	- –Ω–∞–∂–∏–º–∞–µ—Ç `Ctrl+V`
	- –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
	- –Ω–∞–∂–∏–º–∞–µ—Ç `CapsLock`

–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ø–æ—Å–æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `void change_layout()` –≤ `keydeamon.c`

### –∫–∞–∫ —Å–æ–±—Ä–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: `sudo apt install libdbus-1-dev`
```bash
make
sudo make install
make user-setup # –±–µ–∑ sudo
```
–∑–∞–ø—É—Å–∫ –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
sudo chown root linux-punto-switcher
sudo chmod u+s linux-punto-switcher
./linux-punto-switcher
```
—É–¥–∞–ª–µ–Ω–∏–µ:
```bash
make uninstall-user # –±–µ–∑ sudo
sudo make uninstall-system
```
### —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `linux/input` - —Ç—Ä–µ–±—É–µ—Ç root-–ø—Ä–∞–≤
- –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `linux/uinput`  - —Ç—Ä–µ–±—É–µ—Ç root-–ø—Ä–∞–≤
- –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `dbus` (–∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–∞–±–æ—Ç—É —Å KDE) - —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—É –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# todo
- –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞
- deb-–ø–∞–∫–µ—Ç
- —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ json –∏–ª–∏ yaml —Ñ–∞–π–ª–µ
- —Å–¥–µ–ª–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ä–∞—Å–∫–ª–∞–¥–∫–∏ (–¥–ª—è Gnome)
- –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∫–∏ keyview —Å–¥–µ–ª–∞—Ç—å —Å–æ–∑–¥–∞–≤–∞–ª–∫—É —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –ø–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (tablet pc)
# done
- ~~–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã~~ 25-07-24
## –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å deb-–ø–∞–∫–µ—Ç —Å —ç—Ç–∏–º —Ñ–∞–π–ª–æ–º
–ß—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å `.deb`-–ø–∞–∫–µ—Ç –∏–∑ —Ç–≤–æ–µ–≥–æ `keydeamon.c` —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≤ `/usr/local/bin/` –∏ SUID root, –Ω—É–∂–µ–Ω —Å–ª–µ–¥—É—é—â–∏–π –ø–ª–∞–Ω:

---

### ‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç –≤ –ø–∞–∫–µ—Ç–µ:

- `/usr/local/bin/keydeamon` ‚Äî –±–∏–Ω–∞—Ä–Ω–∏–∫ —Å `root:root`, `4755`
    
- `keydeamon.service` ‚Äî **–Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**, –Ω–æ —Å—Ç–∞–≤–∏—Ç—Å—è –ª–∏–±–æ:
    
    - –≤ `~/.config/systemd/user/` —á–µ—Ä–µ–∑ `postinst`
        
    - –∏–ª–∏ –≤ `/usr/share/keydeamon/keydeamon.service` –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä—É—á–Ω—É—é
        

---

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Å–±–æ—Ä–∫–∏ DEB:

```
keydeamon/
‚îú‚îÄ‚îÄ keydeamon.c
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ debian/
‚îÇ   ‚îú‚îÄ‚îÄ control
‚îÇ   ‚îú‚îÄ‚îÄ rules
‚îÇ   ‚îú‚îÄ‚îÄ postinst
‚îÇ   ‚îú‚îÄ‚îÄ keydeamon.service
‚îÇ   ‚îî‚îÄ‚îÄ install
```

---

### üîß 1. `debian/control`

```debcontrol
Source: keydeamon
Section: utils
Priority: optional
Maintainer: Your Name <you@example.com>
Standards-Version: 4.5.0
Package: keydeamon
Architecture: amd64
Depends: ${shlibs:Depends}, ${misc:Depends}
Description: Simple SUID key daemon
 A privileged key monitor with D-Bus access.
```

---

### üõ†Ô∏è 2. `debian/rules`

```makefile
#!/usr/bin/make -f

%:
	dh $@
```

(–°–¥–µ–ª–∞–π —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: `chmod +x debian/rules`)

---

### üß© 3. `debian/install`

```
keydeamon /usr/local/bin
```

---

### ‚öôÔ∏è 4. `debian/postinst`

```sh
#!/bin/sh
set -e

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –ø—Ä–∞–≤–∞
chown root:root /usr/local/bin/keydeamon
chmod 4755 /usr/local/bin/keydeamon

# –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å unit-—Ñ–∞–π–ª –≤ ~/.config/systemd/user/
echo "To enable the keydeamon user service, run:"
echo "  mkdir -p ~/.config/systemd/user"
echo "  cp /usr/share/keydeamon/keydeamon.service ~/.config/systemd/user/"
echo "  systemctl --user daemon-reload && systemctl --user enable --now keydeamon.service"
```

(–°–¥–µ–ª–∞–π —Ñ–∞–π–ª –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: `chmod +x debian/postinst`)

---

### üîå 5. `debian/keydeamon.service`

```ini
[Unit]
Description=Keydeamon

[Service]
ExecStart=/usr/local/bin/keydeamon
Restart=on-failure

[Install]
WantedBy=default.target
```

---

### üß± 6. Makefile (–¥–æ–±–∞–≤–∏–º —Å–±–æ—Ä–∫—É –ø–∞–∫–µ—Ç–∞)

```makefile
CC = clang
SRC = keydeamon.c
BIN = keydeamon
CFLAGS = -Wall -Wextra -Wconversion -Woverflow $(shell pkg-config --cflags dbus-1)
LDFLAGS = $(shell pkg-config --libs dbus-1)

.PHONY: all clean install deb

all: $(BIN)

$(BIN): $(SRC)
	$(CC) $(SRC) -o $(BIN) $(CFLAGS) $(LDFLAGS)

install: $(BIN)
	install -o root -g root -m 4755 $(BIN) /usr/local/bin/$(BIN)

clean:
	rm -f $(BIN)
	dh_clean

deb: clean
	dpkg-buildpackage -us -uc
```

---

### üì¶ –°–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏ –Ω—É–∂–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
    

```sh
sudo apt install build-essential devscripts debhelper dh-make
```

2. –°–æ–±–µ—Ä–∏ –ø–∞–∫–µ—Ç:
    

```sh
make deb
```

–ü–æ—è–≤—è—Ç—Å—è —Ñ–∞–π–ª—ã:

```
../keydeamon_1.0_amd64.deb
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–∞–∫–µ—Ç:
    

```sh
sudo dpkg -i ../keydeamon_1.0_amd64.deb
```

---

### üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –≤—Ä—É—á–Ω—É—é –ø–∏—Å–∞—Ç—å `debian/`, –º–æ–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∫–µ–ª–µ—Ç:

```sh
dh_make -s -f ../keydeamon.tar.gz
```

–ù–æ –≤—Ä—É—á–Ω—É—é ‚Äî –ø—Ä–æ—â–µ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –ø–∞–∫–µ—Ç–æ–≤.

---

–•–æ—á–µ—à—å, —è —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é –∞—Ä—Ö–∏–≤ —Å–æ –≤—Å–µ–º–∏ —ç—Ç–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏?